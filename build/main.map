{"version":3,"sources":["webpack:///webpack/bootstrap f99efd0b3f1018174e5c","webpack:///external \"express\"","webpack:///./src/index.js","webpack:///external \"socket.io\"","webpack:///./src/routes.js","webpack:///external \"path\"","webpack:///./src/redis.js","webpack:///./src/config.js","webpack:///external \"redis\""],"names":["express","require","socketio","router","redis","app","server","listen","io","use","console","log","errorEmit","socket","err","broadcast","emit","doggifyName","name","on","room","Object","keys","rooms","filter","id","forEach","leave","join","data","storeUser","then","dogName","to","getUser","user","Router","path","get","req","res","sendFile","__dirname","module","exports","config","client","createClient","redis_port","redis_host","promiser","resolve","reject","socketID","Promise","setex","expire"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f99efd0b3f1018174e5c","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","const   express = require('express'),\n        socketio = require('socket.io'),\n        router = require('./routes.js'),\n        redis = require('./redis.js');\n\nvar app = express();\nvar server = app.listen(8080);\nvar io = socketio(server);\n\n// app.use(express.static('static'));\napp.use('/', router);\nconsole.log('Starting server...');\n\nvar errorEmit = (socket) => {\n  return (err) => {\n    console.log(err);\n    socket.broadcast.emit('user.events', 'Something went wrong!!');\n  }\n};\n\nvar doggifyName = (name) => {\n  return 'Fluffy Mc' + name + ' Flufffluff';\n};\n\nio.on('connection', (socket) => {\n  socket.on('room.join', (room) => {\n\n    // Leave rooms you aren't in\n    Object.keys(socket.rooms).filter((room) => room != socket.id)\n      .forEach((room) => socket.leave(room));\n\n    // Join the room that the browser tells you to\n    // based on their URL\n    socket.join(room);\n    socket.emit('event', 'Joined room ' + room);\n\n    // Broadcast to all rooms instead\n    // socket.broadcast.to(room).emit('event', 'Someone joined room ' + room);\n\n    socket.broadcast.emit('user.events', 'A new user has joined us in room: ' + room);\n  });\n\n  // TODO:\n  // redis.incrCounter(socket.id);\n\n  socket.on('hello', (data) => {\n    console.log('recieved hello');\n    console.log(data);\n  })\n\n  socket.on('pingFromWeb', (data) => {\n    redis.storeUser(socket.id, data.name).then(() => {\n      console.log('A user called ' + data.name + ' is on the site');\n      let dogName = doggifyName(data.name);\n      socket.broadcast.to(data.room).emit('sendDogName', dogName);\n    }, errorEmit(socket));\n  });\n\n  socket.on('disconnect', () => {\n    redis.getUser(socket.id)\n      .then((user) => {\n        if (user === null) return 'John Doe'\n        else return user\n      })\n      .then((user) => {\n        console.log(user + ' just left.');\n        socket.broadcast.emit('user.events', user + ' has left the room.')\n      }, errorEmit(socket));\n  });\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 3\n// module chunks = 0","const router = require('express').Router();\nvar path = require('path');\n\nrouter.get('/*', (req, res) => {\n  res.sendFile(path.join(__dirname, './static/index.html'));\n});\n\nmodule.exports = router;\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 5\n// module chunks = 0","const   config = require('./config.js'),\n        redis = require('redis');\n\nvar client = redis.createClient(config.redis_port, config.redis_host);\n\nvar promiser = (resolve, reject) => {\n  return (err, data) => {\n    if(err) reject(err);\n    resolve(data);\n  };\n};\n\nvar storeUser = (socketID, user) => {\n  return new Promise((resolve, reject) => {\n    client.setex(socketID, config.expire, user, promiser(resolve, reject));\n  });\n};\n\nvar getUser = (socketID) => {\n  return new Promise((resolve, reject) => {\n    client.get(socketID, promiser(resolve, reject));\n  });\n};\n\n\n// TODO - log how many users are currently on the system\n//\n// var createCounter = (socketID) => {\n//   return new Promise((resolve, reject) => {\n//     client.set(socketID, 'visitorCount', 0, promiser(resolve, reject));\n//   });\n// };\n\n// var incrCounter = (socketID) => {\n//   return new Promise((resolve, reject) => {\n//     client.incr(socketID, 'visitorCount');\n//   });\n// };\n\n// var decrCounter = (socketID) => {\n//   return new Promise((resolve, reject) => {\n//     client.decr(socketID, 'visitorCount', promiser(resolve, reject));\n//   });\n// };\n\nmodule.exports.storeUser = storeUser;\nmodule.exports.getUser = getUser;\n\n// see TODO above\n// module.exports.createCounter = createCounter;\n// module.exports.incrCounter = incrCounter;\n// module.exports.decrCounter = decrCounter;\n\n\n\n// WEBPACK FOOTER //\n// ./src/redis.js","module.exports = {\n  redis_host: '127.0.0.1',\n  redis_port: 16379,\n  expire: 60 * 60 * 1000\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","module.exports = require(\"redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redis\"\n// module id = 8\n// module chunks = 0"],"sourceRoot":""}